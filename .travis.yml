os:
  - windows
  - linux
  - osx

language: c

compiler:
  - gcc

osx_image: xcode10

sudo: required

addons:
  apt:
    sources:
    - sourceline: 'ppa:deadsnakes/ppa'
    - sourceline: 'ppa:duggan/bats'
    packages:
    - bats
    - valgrind

    - python2.3
    - python2.4
    - python2.5
    - python2.6
    - python2.7

    - python3.3
    - python3.4
    - python3.5
    - python3.6
    - python3.7

before_script:
  if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then autoreconf --install; fi

script:
  - if [[ "$TRAVIS_OS_NAME" == "linux"   ]]; then ./configure && make && sudo make check; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx"     ]]; then gcc -Wall -O3 -o austin src/*.c;        fi
  - if [[ "$TRAVIS_OS_NAME" == "windows" ]]; then gcc -Wall -O3 -o austin src/*.c;        fi

after_failure:
  - if [[ "$TRAVIS_OS_NAME" == "linux"   ]]; then cat /var/log/syslog.log | grep austin; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux"   ]]; then cat test-suite.log;                    fi
